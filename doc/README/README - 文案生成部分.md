## 文案生成部分

为了实现真正的基于 AI 的全流程一站式直播解决方案，直播中的文案部分也就成了我们必须考虑的部分。我们在基于 AI 生成的前提下也考虑了直播控制者的主观能动性与全局把控作用，将文案生成部分分为了三部分实现：用户输入主题->AI或用户基于主题生产大纲->用户在直播前、直播中任意地调整大纲内容、顺序以把控直播全局->AI生成具体的文件内容。


### 1. 直播助手AI功能架构解析

#### 1.1 核心模块交互逻辑

1. **输入处理模块**

   - 用户输入主题 → 触发`generateOutline()`方法
   - 输入验证：非空检查 → 禁用生成按钮 → 设置加载状态
   - 逻辑链条：`v-model`双向绑定 → 方法调用 → 状态管理

2. **提纲生成模块**

   - API请求构造：
     ```javascript
     callOpenAI(`为主题"${topic}"生成直播提纲...`)
     ```
   - 响应处理：
     - 成功：拆分行 → 正则匹配章节 → 生成带唯一ID的块对象
     - 失败：错误捕获 → 用户提示 → 状态回滚

3. **内容生成模块**

   > 为了在直播时减少停顿，增加流畅性，我们加入了丰富的文案预生成逻辑。同时通过状态变化验证检测减少不必要的请求与及时生成必要的内容。

   - 三级生成体系：
     1. 主生成：`generateBlockContent()`
     2. 预生成：`generateNextBlockContent()`
     3. 标题变更触发：`generateContentForSpecificBlock()`
   - 防抖机制：通过`isGeneratingContent`状态锁

### 2. 设置页面配置系统

#### 2.1 数据流设计

```mermaid
graph LR
    A[UI输入] --> B[v-model绑定]
    B --> C[本地存储]
    C --> D[API测试]
    D --> E[后端存储]
```

#### 2.2 关键校验逻辑

1. **连接测试流程**：
   - 必填项检查 → 构造测试请求 → 结果解析
   - 特殊处理：
     - 密码字段脱敏显示
     - 温度值范围限制(0-1)

2. **保存逻辑**：
   - 自动测试 → 本地存储 → 后台同步
   - 双模式支持：
     - 即时保存（带提示）
     - 静默保存（完成时）

### 3. 内容处理算法细节

#### 3.1 智能分句算法

```javascript
function splitIntoSentences(text) {
    // 分句逻辑：
    // 1. 按标点分割为数组
    // 2. 奇偶项重组
    // 3. 末尾项特殊处理
    // 4. 空句过滤
}
```

#### 3.2 预生成触发条件

| 触发场景 | 判断条件                | 执行方法                            |
| -------- | ----------------------- | ----------------------------------- |
| 首句播放 | `sentenceIndex === 0`   | `generateNextBlockContent(+1)`      |
| 拖拽结束 | `currentBlockIndex变化` | 检查后续章节空内容                  |
| 标题修改 | `oldTitle !== newTitle` | `generateContentForSpecificBlock()` |

### 4. 异常处理体系

#### 4.1 错误分类处理

1. **API错误**：
   - HTTP状态码分析
   - 响应体结构验证
   - 重试机制（最大3次）

2. **本地错误**：
   - localStorage读写异常
   - 用户输入验证
   - 组件卸载清理

#### 4.2 恢复机制

- 最后有效配置缓存
- 自动回滚到上次成功状态
- 错误边界组件包裹

### 5. 性能优化策略

1. **内存管理**：
   - 分块加载内容
   - 定时清理音频缓存

2. **渲染优化**：
   - 虚拟滚动列表
   - CSS will-change提示

3. **网络优化**：
   - 请求合并
   - 预加载关键资源

该文档详细揭示了各模块间的逻辑关联和数据流转路径，体现了完整的闭环设计思想。
        