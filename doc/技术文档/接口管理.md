# StreamCream æ¥å£ç®¡ç†æ–‡æ¡£

## ğŸ“‹ ç›®å½•
- [1. APIè®¾è®¡è§„èŒƒ](#1-apiè®¾è®¡è§„èŒƒ)
- [2. æ•°æ®ç»“æ„å®šä¹‰](#2-æ•°æ®ç»“æ„å®šä¹‰)
- [3. æ¥å£ç®¡ç†](#3-æ¥å£ç®¡ç†)
- [4. æ•°æ®Mock (Apifox)](#4-æ•°æ®mock-apifox)
- [5. æµ‹è¯•å¥—ä»¶](#5-æµ‹è¯•å¥—ä»¶)
- [6. æ€§èƒ½æµ‹è¯•](#6-æ€§èƒ½æµ‹è¯•)
- [7. æµ‹è¯•ç»“æœå±•ç¤º](#7-æµ‹è¯•ç»“æœå±•ç¤º)
- [8. YAMLé™„ä»¶](#8-YAMLé™„ä»¶)

---

## 1. APIè®¾è®¡è§„èŒƒ

### 1.1 åŸºç¡€è§„èŒƒ

#### 1.1.1 è¯·æ±‚è§„èŒƒ
- **åè®®**: HTTP/HTTPS + WebSocket
- **ç¼–ç **: UTF-8
- **æ ¼å¼**: JSON
- **è®¤è¯**: JWT Bearer Token
- **CORS**: æ”¯æŒè·¨åŸŸè¯·æ±‚

#### 1.1.2 å“åº”è§„èŒƒ
```json
{
  "success": true/false,
  "message": "æ“ä½œç»“æœæè¿°",
  "data": {}, // å…·ä½“æ•°æ®
  "timestamp": "2024-01-01T00:00:00Z",
  "code": 200
}
```

#### 1.1.3 é”™è¯¯ç è§„èŒƒ
| çŠ¶æ€ç  | è¯´æ˜ | ç¤ºä¾‹ |
|--------|------|------|
| 200 | æˆåŠŸ | æ“ä½œæˆåŠŸ |
| 400 | è¯·æ±‚é”™è¯¯ | å‚æ•°éªŒè¯å¤±è´¥ |
| 401 | æœªæˆæƒ | ä»¤ç‰Œæ— æ•ˆ |
| 403 | ç¦æ­¢è®¿é—® | æƒé™ä¸è¶³ |
| 404 | èµ„æºä¸å­˜åœ¨ | ç”¨æˆ·ä¸å­˜åœ¨ |
| 500 | æœåŠ¡å™¨é”™è¯¯ | æ•°æ®åº“è¿æ¥å¤±è´¥ |

### 1.2 æœåŠ¡ç«¯å£åˆ†é…

| æœåŠ¡åç§° | ç«¯å£ | åè®® | ä¸»è¦åŠŸèƒ½ | çŠ¶æ€ |
|----------|------|------|----------|------|
| Login Backend | 9080 | HTTP | ç”¨æˆ·è®¤è¯ã€è®¾ç½®ç®¡ç† | âœ… å®Œæ•´ |
| Stream TTS Backend | 5001 | HTTP | è¯­éŸ³åˆæˆæœåŠ¡ | âœ… å®Œæ•´ |
| Streaming Backend | 8888 | WebSocket | æ¨æµæœåŠ¡ | âœ… å®Œæ•´ |
| GPT-SoVITS API | 9880 | HTTP | AIè¯­éŸ³æ¨¡å‹ | âœ… å®Œæ•´ |

### 1.3 æ¥å£å‘½åè§„èŒƒ

#### 1.3.1 RESTful API
```
GET    /api/users          # è·å–ç”¨æˆ·åˆ—è¡¨
GET    /api/users/{id}     # è·å–ç‰¹å®šç”¨æˆ·
POST   /api/users          # åˆ›å»ºç”¨æˆ·
PUT    /api/users/{id}     # æ›´æ–°ç”¨æˆ·
DELETE /api/users/{id}     # åˆ é™¤ç”¨æˆ·
```

#### 1.3.2 åŠŸèƒ½æ¨¡å—å‰ç¼€
```
/api/auth/*          # è®¤è¯ç›¸å…³
/api/users/*         # ç”¨æˆ·ç®¡ç†
/api/preferences/*   # åå¥½è®¾ç½®
/api/tts/*          # è¯­éŸ³åˆæˆ
/api/streaming/*    # æ¨æµæœåŠ¡
/api/files/*        # æ–‡ä»¶ç®¡ç†
/gpt-sovits/*       # GPT-SoVITS AIæ¨¡å‹
/control/*          # ç³»ç»Ÿæ§åˆ¶
```

---

## 2. æ•°æ®ç»“æ„å®šä¹‰

### 2.1 ç”¨æˆ·ç›¸å…³æ•°æ®ç»“æ„

#### 2.1.1 User æ¨¡å‹
```typescript
interface User {
  id: number;                    // ç”¨æˆ·ID
  username: string;              // ç”¨æˆ·å (3-20å­—ç¬¦)
  email: string;                 // é‚®ç®±åœ°å€
  password_hash: string;         // å¯†ç å“ˆå¸Œ
  email_verified: boolean;       // é‚®ç®±éªŒè¯çŠ¶æ€
  email_verification_code?: string;  // é‚®ç®±éªŒè¯ç 
  email_verification_expires?: Date; // éªŒè¯ç è¿‡æœŸæ—¶é—´
  reset_password_code?: string;      // é‡ç½®å¯†ç éªŒè¯ç 
  reset_password_expires?: Date;     // é‡ç½®å¯†ç éªŒè¯ç è¿‡æœŸæ—¶é—´
  created_at: Date;             // åˆ›å»ºæ—¶é—´
  settings?: UserSetting[];     // ç”¨æˆ·è®¾ç½®
  streams?: Stream[];           // æ¨æµè®°å½•
}
```

#### 2.1.2 UserSetting æ¨¡å‹
```typescript
interface UserSetting {
  id: number;                   // è®¾ç½®ID
  user_id: number;              // ç”¨æˆ·ID
  preferences: {                // åå¥½è®¾ç½®
    debugMode?: boolean;        // è°ƒè¯•æ¨¡å¼
    bannerColor?: string;       // æ¨ªå¹…é¢œè‰²
    aiSettings?: {              // AIè®¾ç½®
      provider?: string;        // æä¾›å•†URL
      apiKey?: string;          // APIå¯†é’¥
      modelName?: string;       // æ¨¡å‹åç§°
      temperature?: number;     // æ¸©åº¦å‚æ•°
      maxTokens?: number;       // æœ€å¤§ä»¤ç‰Œæ•°
    };
    liveSettings?: {            // ç›´æ’­è®¾ç½®
      resolution?: string;      // åˆ†è¾¨ç‡
      fps?: string;             // å¸§ç‡
      bgPreference?: string;    // èƒŒæ™¯åå¥½
      platformPreference?: string; // å¹³å°åå¥½
    };
  };
  created_at: Date;             // åˆ›å»ºæ—¶é—´
  updated_at: Date;             // æ›´æ–°æ—¶é—´
}
```

#### 2.1.3 Stream æ¨¡å‹
```typescript
interface Stream {
  id: number;                   // æ¨æµID
  user_id: number;              // ç”¨æˆ·ID
  title: string;                // æ¨æµæ ‡é¢˜
  description?: string;         // æ¨æµæè¿°
  stream_key: string;           // æ¨æµå¯†é’¥
  is_live: boolean;             // æ˜¯å¦æ­£åœ¨ç›´æ’­
  start_time?: Date;            // å¼€å§‹æ—¶é—´
  end_time?: Date;              // ç»“æŸæ—¶é—´
  created_at: Date;             // åˆ›å»ºæ—¶é—´
}
```

### 2.2 è¯­éŸ³åˆæˆç›¸å…³æ•°æ®ç»“æ„

#### 2.2.1 TTSRequest è¯·æ±‚ç»“æ„
```typescript
interface TTSRequest {
  text: string;                 // è¦åˆæˆçš„æ–‡æœ¬
  voice?: string;               // è¯­éŸ³ç±»å‹ (å¯é€‰)
  language?: string;            // è¯­è¨€ (é»˜è®¤zh)
  speed?: number;               // è¯­é€Ÿ (0.5-2.0)
  pitch?: number;               // éŸ³è°ƒ (-12-12)
}
```

#### 2.2.2 TTSResponse å“åº”ç»“æ„
```typescript
interface TTSResponse {
  audio_url: string;            // éŸ³é¢‘æ–‡ä»¶URL
  text: string;                 // åŸå§‹æ–‡æœ¬
  duration: number;             // éŸ³é¢‘æ—¶é•¿(ç§’)
  file_size: number;            // æ–‡ä»¶å¤§å°(å­—èŠ‚)
  format: string;               // éŸ³é¢‘æ ¼å¼
}
```

#### 2.2.3 MouthTimeline å£å‹æ—¶é—´è½´
```typescript
interface MouthTimeline {
  start: number;                // å¼€å§‹æ—¶é—´(ç§’)
  end: number;                  // ç»“æŸæ—¶é—´(ç§’)
  vowel: string;                // å…ƒéŸ³ç±»å‹
  char: string;                 // å¯¹åº”å­—ç¬¦
  mouth_open: number;           // å˜´éƒ¨å¼€åˆåº¦ (0-1)
  mouth_shape: string;          // å˜´éƒ¨å½¢çŠ¶
}
```

### 2.3 æ¨æµç›¸å…³æ•°æ®ç»“æ„

#### 2.3.1 StreamConfig æ¨æµé…ç½®
```typescript
interface StreamConfig {
  rtmp_url: string;             // RTMPæœåŠ¡å™¨åœ°å€
  stream_key: string;           // æ¨æµå¯†é’¥
  resolution: string;           // åˆ†è¾¨ç‡ (1920x1080)
  fps: number;                  // å¸§ç‡ (30/60)
  bitrate: number;              // æ¯”ç‰¹ç‡ (kbps)
  audio_codec: string;          // éŸ³é¢‘ç¼–ç  (aac)
  video_codec: string;          // è§†é¢‘ç¼–ç  (h264)
}
```

#### 2.3.2 StreamStatus æ¨æµçŠ¶æ€
```typescript
interface StreamStatus {
  is_connected: boolean;        // æ˜¯å¦å·²è¿æ¥
  is_streaming: boolean;        // æ˜¯å¦æ­£åœ¨æ¨æµ
  start_time?: Date;            // å¼€å§‹æ—¶é—´
  duration: number;             // æ¨æµæ—¶é•¿(ç§’)
  bytes_sent: number;           // å·²å‘é€å­—èŠ‚æ•°
  frames_sent: number;          // å·²å‘é€å¸§æ•°
  errors: string[];             // é”™è¯¯ä¿¡æ¯
}
```

### 2.4 GPT-SoVITSç›¸å…³æ•°æ®ç»“æ„

#### 2.4.1 TTSRequest GPT-SoVITSè¯·æ±‚
```typescript
interface TTSRequest {
  text: string;                 // è¦åˆæˆçš„æ–‡æœ¬
  text_lang: string;            // æ–‡æœ¬è¯­è¨€ (zh/en)
  ref_audio_path: string;       // å‚è€ƒéŸ³é¢‘è·¯å¾„
  aux_ref_audio_paths?: string[]; // è¾…åŠ©å‚è€ƒéŸ³é¢‘è·¯å¾„
  prompt_lang: string;          // æç¤ºæ–‡æœ¬è¯­è¨€
  prompt_text?: string;         // æç¤ºæ–‡æœ¬
  top_k?: number;               // top ké‡‡æ · (é»˜è®¤5)
  top_p?: number;               // top pé‡‡æ · (é»˜è®¤1)
  temperature?: number;         // é‡‡æ ·æ¸©åº¦ (é»˜è®¤1)
  text_split_method?: string;   // æ–‡æœ¬åˆ†å‰²æ–¹æ³• (é»˜è®¤cut0)
  batch_size?: number;          // æ‰¹å¤„ç†å¤§å° (é»˜è®¤1)
  batch_threshold?: number;     // æ‰¹å¤„ç†é˜ˆå€¼ (é»˜è®¤0.75)
  split_bucket?: boolean;       // æ˜¯å¦åˆ†å‰²åˆ°å¤šä¸ªæ¡¶ (é»˜è®¤true)
  speed_factor?: number;        // é€Ÿåº¦å› å­ (é»˜è®¤1.0)
  fragment_interval?: number;   // ç‰‡æ®µé—´éš” (é»˜è®¤0.3)
  seed?: number;                // éšæœºç§å­ (é»˜è®¤-1)
  media_type?: string;          // åª’ä½“ç±»å‹ (é»˜è®¤wav)
  streaming_mode?: boolean;     // æµå¼æ¨¡å¼ (é»˜è®¤false)
  parallel_infer?: boolean;     // å¹¶è¡Œæ¨ç† (é»˜è®¤true)
  repetition_penalty?: number;  // é‡å¤æƒ©ç½š (é»˜è®¤1.35)
  sample_steps?: number;        // é‡‡æ ·æ­¥æ•° (é»˜è®¤32)
  super_sampling?: boolean;     // è¶…é‡‡æ · (é»˜è®¤false)
}
```

#### 2.4.2 ModelGroup æ¨¡å‹ç»„
```typescript
interface ModelGroup {
  name: string;                 // æ¨¡å‹ç»„åç§°
  gpt_weights: string;          // GPTæƒé‡æ–‡ä»¶è·¯å¾„
  sovits_weights: string;       // SoVITSæƒé‡æ–‡ä»¶è·¯å¾„
  ref_audio: string;            // å‚è€ƒéŸ³é¢‘æ–‡ä»¶è·¯å¾„
}
```

#### 2.4.3 SystemStatus ç³»ç»ŸçŠ¶æ€
```typescript
interface SystemStatus {
  gpt_weights: string;          // å½“å‰GPTæƒé‡æ–‡ä»¶
  sovits_weights: string;       // å½“å‰SoVITSæƒé‡æ–‡ä»¶
  ref_audio: string;            // å½“å‰å‚è€ƒéŸ³é¢‘æ–‡ä»¶
  model_pair: string;           // å½“å‰æ¨¡å‹å¯¹åç§°
}
```

---

## 3. æ¥å£ç®¡ç†

### 3.1 æ¥å£æ–‡æ¡£ç®¡ç†

#### 3.1.1 æ–‡æ¡£å·¥å…·
- **ä¸»è¦å·¥å…·**: OpenAPI 3.0.3 (Swagger)
- **è¾…åŠ©å·¥å…·**: Apifox (æ¥å£æµ‹è¯•)
- **æ–‡æ¡£åœ°å€**: `/api-docs` (Swagger UI)

### 3.2 æ¥å£ç›‘æ§

#### 3.2.1 ç›‘æ§æŒ‡æ ‡
- **å“åº”æ—¶é—´**: å¹³å‡å“åº”æ—¶é—´ < 500ms
- **æˆåŠŸç‡**: æ¥å£æˆåŠŸç‡ > 99%
- **é”™è¯¯ç‡**: é”™è¯¯ç‡ < 1%
- **å¹¶å‘æ•°**: æ”¯æŒå¹¶å‘è¯·æ±‚æ•°

#### 3.2.2 ç›‘æ§å·¥å…·
- **åº”ç”¨ç›‘æ§**: è‡ªå®šä¹‰æ—¥å¿—ç³»ç»Ÿ + æ§åˆ¶å°è¾“å‡º
- **æ—¥å¿—ç®¡ç†**: å‰ç«¯æ—¥å¿—ç»„ä»¶ + åç«¯printè¾“å‡º
- **è¿›ç¨‹ç›‘æ§**: Python subprocess + è¿›ç¨‹çŠ¶æ€æ£€æŸ¥
- **å®æ—¶ç›‘æ§**: WebSocketè¿æ¥çŠ¶æ€ + å‰ç«¯çŠ¶æ€æ˜¾ç¤º

### 3.3 æ¥å£å®‰å…¨

#### 3.3.1 è®¤è¯æœºåˆ¶
```typescript
// JWT Token ç»“æ„
interface JWTPayload {
  user_id: number;              // ç”¨æˆ·ID
  token_id: string;             // ä»¤ç‰Œå”¯ä¸€æ ‡è¯†
  iat: number;                  // ç­¾å‘æ—¶é—´
  exp: number;                  // è¿‡æœŸæ—¶é—´
  jti: string;                  // JWT ID
}
```

#### 3.3.2 æƒé™æ§åˆ¶
- **å…¬å¼€æ¥å£**: æ³¨å†Œã€ç™»å½•ã€å¥åº·æ£€æŸ¥
- **è®¤è¯æ¥å£**: éœ€è¦JWTä»¤ç‰Œ

#### 3.3.3 å®‰å…¨æªæ–½
- **CORS**: è·¨åŸŸè¯·æ±‚æ§åˆ¶
- **Rate Limiting**: è¯·æ±‚é¢‘ç‡é™åˆ¶
- **Input Validation**: è¾“å…¥éªŒè¯
- **SQL Injection**: SQLæ³¨å…¥é˜²æŠ¤

---

## 4. æ•°æ®Mock (Apifox)

### 4.1 Mockæ•°æ®é…ç½®

#### 4.1.1 ç”¨æˆ·ç›¸å…³Mockæ•°æ®

**ç”¨æˆ·æ³¨å†Œå“åº”**
```json
{
  "success": true,
  "message": "æ³¨å†ŒæˆåŠŸï¼ŒéªŒè¯ç å·²å‘é€åˆ°é‚®ç®±",
  "data": {
    "user_id": 12345,
    "email": "test@example.com",
    "verification_expires": "2024-01-01T00:10:00Z"
  },
  "timestamp": "2024-01-01T00:00:00Z",
  "code": 200
}
```

**ç”¨æˆ·ç™»å½•å“åº”**
```json
{
  "success": true,
  "message": "ç™»å½•æˆåŠŸ",
  "data": {
    "token": "eyJhbGciOiJIUzI1NiIsInR5cCI6IkpXVCJ9...",
    "user": {
      "id": 12345,
      "username": "testuser",
      "email": "test@example.com",
      "email_verified": true
    }
  },
  "timestamp": "2024-01-01T00:00:00Z",
  "code": 200
}
```

**ç”¨æˆ·åå¥½è®¾ç½®**
```json
{
  "success": true,
  "data": {
    "debugMode": false,
    "bannerColor": "default",
    "aiSettings": {
      "provider": "https://api.openai.com/v1/chat/completions",
      "apiKey": "sk-...",
      "modelName": "gpt-4o",
      "temperature": 0.7,
      "maxTokens": 1000
    },
    "liveSettings": {
      "resolution": "1920x1080",
      "fps": "30",
      "bgPreference": "default",
      "platformPreference": "bilibili"
    }
  }
}
```

#### 4.1.2 è¯­éŸ³åˆæˆMockæ•°æ®

**è¯­éŸ³åˆæˆå“åº”**
```json
{
  "audio_url": "/static/audio/speech_1704067200.wav",
  "text": "å¤§å®¶å¥½ï¼Œæ¬¢è¿æ¥åˆ°æˆ‘çš„ç›´æ’­é—´",
  "duration": 3.6,
  "file_size": 57600,
  "format": "wav"
}
```

**å£å‹æ—¶é—´è½´**
```json
[
  {
    "start": 0.0,
    "end": 0.3,
    "vowel": "a",
    "char": "å¤§",
    "mouth_open": 0.8,
    "mouth_shape": "a"
  },
  {
    "start": 0.3,
    "end": 0.6,
    "vowel": "a",
    "char": "å®¶",
    "mouth_open": 0.7,
    "mouth_shape": "a"
  },
  {
    "start": 0.6,
    "end": 0.9,
    "vowel": "h",
    "char": "å¥½",
    "mouth_open": 0.6,
    "mouth_shape": "h"
  }
]
```

#### 4.1.3 æ¨æµç›¸å…³Mockæ•°æ®

**æ¨æµé…ç½®**
```json
{
  "rtmp_url": "rtmp://live-push.bilivideo.com/live-bvc",
  "stream_key": "abc123def456",
  "resolution": "1920x1080",
  "fps": 30,
  "bitrate": 4000,
  "audio_codec": "aac",
  "video_codec": "h264"
}
```

**æ¨æµçŠ¶æ€**
```json
{
  "is_connected": true,
  "is_streaming": true,
  "start_time": "2024-01-01T00:00:00Z",
  "duration": 3600,
  "bytes_sent": 1073741824,
  "frames_sent": 108000,
  "errors": []
}
```

#### 4.1.4 GPT-SoVITSç›¸å…³Mockæ•°æ®

**TTSåˆæˆå“åº”**
```json
{
  "success": true,
  "message": "è¯­éŸ³åˆæˆæˆåŠŸ",
  "data": {
    "audio_url": "/gpt-sovits/audio/speech_1704067200.wav",
    "text": "å¤§å®¶å¥½ï¼Œæ¬¢è¿æ¥åˆ°æˆ‘çš„ç›´æ’­é—´",
    "duration": 3.6,
    "file_size": 57600,
    "format": "wav",
    "model_used": "example_model"
  },
  "timestamp": "2024-01-01T00:00:00Z",
  "code": 200
}
```

**æ¨¡å‹åˆ—è¡¨å“åº”**
```json
{
  "success": true,
  "data": {
    "models": [
      {
        "name": "example_model",
        "gpt_weights": "userdatas/tts/GPT_weights/example_model-e15.ckpt",
        "sovits_weights": "userdatas/tts/SoVITS_weights/example_model_e8_s2184.pth",
        "ref_audio": "userdatas/tts/ref_audio/example.wav"
      }
    ],
    "current_model": "example_model"
  }
}
```

**ç³»ç»ŸçŠ¶æ€å“åº”**
```json
{
  "success": true,
  "data": {
    "gpt_weights": "userdatas/tts/GPT_weights/example_model-e15.ckpt",
    "sovits_weights": "userdatas/tts/SoVITS_weights/example_model_e8_s2184.pth",
    "ref_audio": "userdatas/tts/ref_audio/example.wav",
    "model_pair": "example_model"
  }
}
```

### 4.2 Apifoxé¡¹ç›®é…ç½®

#### 4.2.1 é¡¹ç›®ç»“æ„
```
StreamCream API
â”œâ”€â”€ è®¤è¯æœåŠ¡ (9080)
â”‚   â”œâ”€â”€ ç”¨æˆ·æ³¨å†Œ
â”‚   â”œâ”€â”€ ç”¨æˆ·ç™»å½•
â”‚   â”œâ”€â”€ é‚®ç®±éªŒè¯
â”‚   â””â”€â”€ å¯†ç é‡ç½®
â”œâ”€â”€ è¯­éŸ³åˆæˆ (5001)
â”‚   â”œâ”€â”€ æ–‡æœ¬è½¬è¯­éŸ³
â”‚   â”œâ”€â”€ å£å‹ç”Ÿæˆ
â”‚   â””â”€â”€ éŸ³é¢‘ç®¡ç†
â”œâ”€â”€ æ¨æµæœåŠ¡ (8888)
â”‚   â”œâ”€â”€ WebSocketè¿æ¥
â”‚   â””â”€â”€ æ¨æµçŠ¶æ€
â”œâ”€â”€ GPT-SoVITS (9880)
â”‚   â”œâ”€â”€ è¯­éŸ³åˆæˆ
â”‚   â”œâ”€â”€ æ¨¡å‹ç®¡ç†
â”‚   â”œâ”€â”€ éŸ³é¢‘ä¸Šä¼ 
â”‚   â””â”€â”€ ç³»ç»Ÿæ§åˆ¶
â””â”€â”€ æ–‡ä»¶ç®¡ç†
    â”œâ”€â”€ èƒŒæ™¯ä¸Šä¼ 
    â””â”€â”€ éŸ³é¢‘æ–‡ä»¶
```

#### 4.2.2 ç¯å¢ƒå˜é‡é…ç½®
```json
// å¼€å‘ç¯å¢ƒ
{
  "base_url": "http://localhost:9080",
  "tts_url": "http://localhost:5001",
  "streaming_url": "ws://localhost:8888",
  "gpt_sovits_url": "http://localhost:9880",
  "token": "{{auth_token}}"
}

// æµ‹è¯•ç¯å¢ƒ
{
  "base_url": "http://test-api.streamcream.com",
  "tts_url": "http://test-tts.streamcream.com",
  "streaming_url": "ws://test-streaming.streamcream.com",
  "gpt_sovits_url": "http://test-gpt.streamcream.com",
  "token": "{{auth_token}}"
}
```

---

## 5. æµ‹è¯•å¥—ä»¶

### 1. ç”¨æˆ·ä¸é‰´æƒæµ‹è¯•
- æ³¨å†Œæ–°ç”¨æˆ·ï¼Œæ ¡éªŒå”¯ä¸€æ€§
- æ­£ç¡®ç”¨æˆ·åå¯†ç ç™»å½•ï¼Œè¿”å› token
- é”™è¯¯ç”¨æˆ·å/å¯†ç ç™»å½•ï¼Œè¿”å›é”™è¯¯ç 
- token è¿‡æœŸ/æ— æ•ˆè®¿é—®å—ä¿æŠ¤æ¥å£ï¼Œè¿”å›æœªæˆæƒ
- æ ¡éªŒ token æœ‰æ•ˆæ€§æ¥å£

### 2. åå¥½è®¾ç½®æ¥å£æµ‹è¯•
- è·å–åå¥½è®¾ç½®ï¼Œè¿”å›æ­£ç¡®æ•°æ®
- ä¿®æ”¹åå¥½è®¾ç½®ï¼Œæ•°æ®å†™å…¥æ•°æ®åº“
- éæ³•å‚æ•°æ ¡éªŒï¼ˆå¦‚ç©ºå­—ç¬¦ä¸²ã€æ ¼å¼é”™è¯¯ï¼‰

### 3. èƒŒæ™¯å›¾ç‰‡ç®¡ç†æµ‹è¯•
- ä¸Šä¼ èƒŒæ™¯å›¾ç‰‡ï¼Œè¿”å›æ–‡ä»¶å
- è·å–æœ€æ–°èƒŒæ™¯å›¾ç‰‡ï¼Œè¿”å›å›¾ç‰‡æµ
- ä¸Šä¼ æ— æ•ˆæ–‡ä»¶ç±»å‹ï¼Œè¿”å›é”™è¯¯

### 4. TTS è¯­éŸ³åˆæˆä¸ç®¡ç†æµ‹è¯•
- ç”Ÿæˆæ¼”è®²æ–‡æœ¬ï¼Œtopic åˆç†è¿”å›å†…å®¹
- åˆæˆè¯­éŸ³ï¼Œè¿”å›éŸ³é¢‘url
- è·å–éŸ³é¢‘æ–‡ä»¶ï¼Œè¿”å›éŸ³é¢‘æµ
- åˆæˆç©ºæ–‡æœ¬/æ— æ•ˆå‚æ•°ï¼Œè¿”å›é”™è¯¯

### 5. WebSocket æ¨æµæµ‹è¯•
- WebSocket è¿æ¥å»ºç«‹ï¼Œé¦–æ¡æ¶ˆæ¯ä¸º JSONï¼Œè¿”å›æ­£å¸¸
- ç¼ºå°‘ rtmp_url/stream_keyï¼Œè¿”å›é”™è¯¯æç¤º
- æŒç»­æ¨é€äºŒè¿›åˆ¶æµï¼Œåç«¯ ffmpeg æ­£å¸¸å¯åŠ¨å¹¶æ¨æµ
- æ–­å¼€è¿æ¥åï¼Œffmpeg è¿›ç¨‹è¢«å…³é—­

### 6. GPT-SoVITS è¯­éŸ³åˆæˆåç«¯æµ‹è¯•
- TTS åˆæˆæ¥å£ï¼Œåˆæ³•æ–‡æœ¬åˆæˆè¿”å›éŸ³é¢‘æµ
- TTS åˆæˆæ¥å£ï¼Œç©ºæ–‡æœ¬/å¼‚å¸¸å‚æ•°è¿”å›é”™è¯¯
- TTS åˆæˆæ¥å£ï¼Œæµ‹è¯•ä¸åŒ media_typeã€streaming_mode
- è®¾ç½®å‚è€ƒéŸ³é¢‘ï¼Œåˆ‡æ¢ååˆæˆç»“æœå˜åŒ–
- æŸ¥è¯¢å½“å‰å‚è€ƒéŸ³é¢‘ï¼Œè¿”å›æ­£ç¡®è·¯å¾„
- åˆ—å‡ºå¯ç”¨å‚è€ƒéŸ³é¢‘ï¼Œè¿”å›å®Œæ•´åˆ—è¡¨
- åˆ‡æ¢GPT/SoVITSæ¨¡å‹ï¼Œåˆæˆç»“æœå˜åŒ–
- æŸ¥è¯¢å½“å‰çŠ¶æ€ï¼Œè¿”å›å®Œæ•´ä¿¡æ¯

---

## 6. æ€§èƒ½æµ‹è¯•

### 6.1 æ€§èƒ½æŒ‡æ ‡

**å“åº”æ—¶é—´è¦æ±‚**
- ç™»å½•æ¥å£: < 200ms
- ç”¨æˆ·ä¿¡æ¯æŸ¥è¯¢: < 100ms
- åå¥½è®¾ç½®è¯»å†™: < 150ms
- è¯­éŸ³åˆæˆ: < 5s
- æ–‡ä»¶ä¸Šä¼ : < 10s
- GPT-SoVITSåˆæˆ: < 30s
- æ¨¡å‹åˆ‡æ¢: < 10s

**å¹¶å‘æ€§èƒ½è¦æ±‚**
- æ”¯æŒ100ä¸ªå¹¶å‘ç”¨æˆ·
- æ•°æ®åº“è¿æ¥æ± : 20ä¸ªè¿æ¥
- æ–‡ä»¶ä¸Šä¼ : 10MBé™åˆ¶
- WebSocketè¿æ¥: 50ä¸ªå¹¶å‘
- GPT-SoVITSæ¨ç†: 5ä¸ªå¹¶å‘

### 6.2 å‹åŠ›æµ‹è¯•

#### 6.2.1 æµ‹è¯•å·¥å…·
- **Apifox**: æ¥å£åŠŸèƒ½æµ‹è¯•ã€å‹åŠ›æµ‹è¯•ã€è‡ªåŠ¨åŒ–æµ‹è¯•
- **æµè§ˆå™¨å¼€å‘è€…å·¥å…·**: å‰ç«¯æ€§èƒ½æµ‹è¯•

#### 6.2.2 æµ‹è¯•åœºæ™¯
```javascript
// Apifoxæµ‹è¯•è®¡åˆ’
{
  "name": "StreamCreamæ¥å£æµ‹è¯•",
  "scenarios": [
    {
      "name": "ç”¨æˆ·è®¤è¯æµ‹è¯•",
      "requests": [
        "/api/auth/register",
        "/api/auth/login",
        "/api/auth/verify-token"
      ]
    },
    {
      "name": "åå¥½è®¾ç½®æµ‹è¯•",
      "requests": [
        "/api/preferences",
        "/api/files/upload-background"
      ]
    },
    {
      "name": "è¯­éŸ³åˆæˆæµ‹è¯•",
      "requests": [
        "/api/tts/synthesize",
        "/gpt-sovits/tts"
      ]
    }
  ],
  "settings": {
    "iterations": 10,
    "concurrency": 5,
    "delay": 1000
  }
}
```

### 6.3 ç›‘æ§æŒ‡æ ‡

#### 6.3.1 ç³»ç»ŸæŒ‡æ ‡
- CPUä½¿ç”¨ç‡ < 80%
- å†…å­˜ä½¿ç”¨ç‡ < 85%
- ç£ç›˜I/O < 70%
- ç½‘ç»œå¸¦å®½ < 80%

#### 6.3.2 åº”ç”¨æŒ‡æ ‡
- æ¥å£æˆåŠŸç‡ > 99%
- å¹³å‡å“åº”æ—¶é—´ < 500ms
- é”™è¯¯ç‡ < 1%
- å¹¶å‘è¿æ¥æ•° < 1000

#### 6.3.3 å®é™…ç›‘æ§å®ç°
```python
# åç«¯è¿›ç¨‹ç›‘æ§ (start_all_backends.py)
def monitor_processes():
    for name, process in processes:
        if process.poll() is not None:
            print(f'è­¦å‘Š: {name} å·²é€€å‡ºï¼ŒçŠ¶æ€ç : {process.returncode}')

# å‰ç«¯æ—¥å¿—ç›‘æ§ (DouyinStream.vue)
function addLog(message, type = 'info') {
    const logEntry = {
        message,
        type,
        timestamp: new Date(),
        timeString: timestamp.toLocaleTimeString()
    };
    logs.value.unshift(logEntry);
    console.log(`[${type.toUpperCase()}] ${message}`);
}

# WebSocketè¿æ¥ç›‘æ§ (BroadcastInterface.vue)
this.wsConnection.onopen = () => {
    console.log('WebSocketè¿æ¥å·²å»ºç«‹');
    this.isConnected = true;
};

this.wsConnection.onerror = (error) => {
    console.error('WebSocketè¿æ¥é”™è¯¯:', error);
    this.isConnected = false;
};
```

---

## 7. æµ‹è¯•ç»“æœå±•ç¤º

### 7.1 æ¥å£åŠŸèƒ½æµ‹è¯•æŠ¥å‘Š

[æŸ¥çœ‹å®Œæ•´HTMLæŠ¥å‘Š](assests/api.assests/apifox_test_report.html)

![æ¥å£åŠŸèƒ½æµ‹è¯•æŠ¥å‘Šæˆªå›¾](assests/api.assests/apifox_test_report.png)

> **è¯´æ˜**ï¼šä¸Šå›¾ä¸ºApifoxè‡ªåŠ¨åŒ–æ¥å£åŠŸèƒ½æµ‹è¯•çš„ç»“æœæˆªå›¾ï¼Œæ¶µç›–æ‰€æœ‰ä¸»è¦æ¥å£çš„é€šè¿‡ç‡ã€å“åº”æ—¶é—´ç­‰æ ¸å¿ƒæŒ‡æ ‡ã€‚ç‚¹å‡»ä¸Šæ–¹é“¾æ¥å¯æŸ¥çœ‹å®Œæ•´çš„HTMLæµ‹è¯•æŠ¥å‘Šã€‚

---

### 7.2 æ€§èƒ½æµ‹è¯•æŠ¥å‘Š

![æ€§èƒ½æµ‹è¯•æŠ¥å‘Šæˆªå›¾](assests/api.assests/performance_test_report.png)

> **è¯´æ˜**ï¼šä¸Šå›¾ä¸ºApifoxå‹åŠ›æµ‹è¯•/æ€§èƒ½æµ‹è¯•çš„ç»“æœæˆªå›¾ï¼Œå±•ç¤ºäº†å¹¶å‘ã€å“åº”æ—¶é—´ã€é”™è¯¯ç‡ç­‰æ€§èƒ½æŒ‡æ ‡ã€‚ç‚¹å‡»ä¸Šæ–¹é“¾æ¥å¯æŸ¥çœ‹å®Œæ•´çš„HTMLæµ‹è¯•æŠ¥å‘Šã€‚

---
### 7.3 æœ¬åœ°mockæµ‹è¯•æŠ¥å‘Š

[æŸ¥çœ‹å®Œæ•´HTMLæŠ¥å‘Š](assests/api.assests/mock_test_report.html)

![æ€§èƒ½æµ‹è¯•æŠ¥å‘Šæˆªå›¾](assests/api.assests/mock_test_report.png)

---

## 8. YAMLé™„ä»¶

### 8.1 å®Œæ•´APIæ–‡æ¡£

æœ¬é¡¹ç›®ä½¿ç”¨OpenAPI 3.0.3è§„èŒƒå®šä¹‰æ‰€æœ‰æ¥å£ï¼Œå®Œæ•´çš„YAMLæ–‡æ¡£å¦‚ä¸‹ï¼š

```yaml
# å®Œæ•´APIæ–‡æ¡£ (api-documentation-complete.yaml)
# åŒ…å«æ‰€æœ‰åç«¯æœåŠ¡çš„æ¥å£å®šä¹‰
# æ”¯æŒSwagger UIå’ŒApifoxå¯¼å…¥ä½¿ç”¨

openapi: 3.0.3
info:
  title: StreamCream API
  description: |
    StreamCreamé¡¹ç›®å®Œæ•´APIæ–‡æ¡£
    åŒ…å«ç”¨æˆ·è®¤è¯ã€è¯­éŸ³åˆæˆã€æ¨æµæœåŠ¡ã€GPT-SoVITSç­‰æ‰€æœ‰æ¥å£
    
    æœåŠ¡ç«¯å£åˆ†å¸ƒï¼š
    - ç”¨æˆ·è®¤è¯æœåŠ¡: 9080
    - è¯­éŸ³åˆæˆæœåŠ¡: 5001  
    - æ¨æµæœåŠ¡: 8888
    - GPT-SoVITSæœåŠ¡: 9880
    
  version: 1.0.0
  contact:
    name: StreamCreamå¼€å‘å›¢é˜Ÿ
    email: support@streamcream.com

servers:
  - url: http://localhost:9080
    description: ç”¨æˆ·è®¤è¯æœåŠ¡
  - url: http://localhost:5001  
    description: è¯­éŸ³åˆæˆæœåŠ¡
  - url: http://localhost:8888
    description: æ¨æµæœåŠ¡
  - url: http://localhost:9880
    description: GPT-SoVITSæœåŠ¡

# å®Œæ•´æ¥å£å®šä¹‰è¯·å‚è€ƒ: api-documentation.yaml
```

> **ä½¿ç”¨è¯´æ˜**ï¼š
> 1. å¯ç›´æ¥å¯¼å…¥Swagger UIæŸ¥çœ‹æ¥å£æ–‡æ¡£
> 2. å¯å¯¼å…¥Apifoxè¿›è¡Œæ¥å£æµ‹è¯•å’Œç®¡ç†
> 3. æ”¯æŒä»£ç ç”Ÿæˆå’ŒMockæ•°æ®é…ç½®
> 4. åŒ…å«æ‰€æœ‰æœåŠ¡çš„å®Œæ•´æ¥å£å®šä¹‰
