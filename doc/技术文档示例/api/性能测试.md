# 性能测试

性能测试是通过自动化的测试工具模拟多种正常、峰值以及异常负载条件来对系统的各项性能指标进行测试。负载测试和压力测试都属于性能测试，两者可以结合进行。通过负载测试，确定在各种工作负载下系统的性能，目标是测试当负载逐渐增加时，系统各项性能指标的变化情况。压力测试是通过确定一个系统的瓶颈或者不能接受的性能点，来获得系统能提供的最大服务级别的测试。

## QPS，TPS，吞吐量

### TPS

Transactions Per Second（每秒传输的事物处理个数），即服务器**每秒**处理的事务数。TPS包括一条消息入和一条消息出，加上一次用户数据库访问.

TPS是软件测试结果的测量单位。一个事务是指一个客户机向服务器发送请求然后服务器做出反应的过程。客户机在发送请求时开始计时，收到服务器响应后结束计时，以此来计算使用的时间和完成的事务个数。

一般的，评价系统性能均以每秒钟完成的技术交易的数量来衡量。系统整体处理能力取决于处理能力最低模块的TPS值。

例如：天猫双十一，一秒完成多少订单

 ### QPS

每秒查询率QPS是对一个特定的查询服务器在**规定时间内**所处理流量多少的衡量标准，在因特网上，作为域名系统服务器的机器的性能经常用每秒查询率来衡量。

对应fetches/sec，即每秒的响应请求数，也即是最大吞吐能力。

### QPS与TPS的区别

我日常都会使用TPS，每秒事务数，之所以是事务这个概念，是因为我们在请求过程中会增加检查点，检查点成功就是事务成功，检查点失败就意味着失败，所以我们的请求就是一次事务，故**TPS=QPS**（每秒请求数），所以**大部分条件下，这两个概念不用纠结的**！

那么什么时候不相等呢？

举个例子，我需要进行一次查询，但这个查询需要调用A服务和B服务，而调用B服务需要2次调用，那么这种情况，以我查询这个场景成功作为一次事务的话，我一秒请求一笔就是1tps，当然对于A系统是1tps=1qps的，但对于B系统而言，就是2qps，因为调用了两次（如果只看B服务的话，把每次请求当做一次事务的话2qps=2tps，还是可以等同的）

所以仅仅是关注维度的不同，绝大多数时候我们不用去刻意区分的，毕竟我可以说我流程是1tps，B系统受到的双倍额压力是2tps的量(**压测过程中也务必关注这样的流量放大服务**，因为很有可能前面的服务抗的住，后面扛不住)，这样也是完全没有问题的。

> TPS：整个业务逻辑执行的数量（不关心具体业务执行细节）
>
> QPS：一个TPS可能由多个子QPS组成
>
> :fire: 实际也不用太纠结，反正QPS慢，TPS也不可能快起来

### 系统吞吐量要素

一个系统的**吞吐量**（承压能力）与request对CPU的消耗、外部接口、IO等等紧密关联。单个reqeust 对CPU消耗越高，外部系统接口、IO影响速度越慢，系统吞吐能力越低，反之越高。

系统吞吐量几个重要参数：QPS（TPS）、并发数、响应时间

* QPS（TPS）：每秒钟request/事务数量
* 并发数： 系统同时处理的request/事务数
* 响应时间： 一般取平均响应时间

理解了上面三个要素的意义之后，就能推算出它们之间的关系：

* QPS（TPS）= 并发数/平均响应时间

 tps ：每秒的响应事务数量  例如：天猫双十一，一秒完成多少订单
qps : 每秒的响应请求数量  例如： 
吞吐量（throughput）(qps):并发在多少的时候，网站的qps是多少
QPS（TPS）= 并发数/平均响应时间

## Apache Benchmark

### ab简介

ab，即Apache Benchmark，是一种用于测试Apache超文本传输协议（HTTP）服务器的工具。

ab命令会创建很多的并发访问线程，模拟多个访问者同时对某一URL地址进行访问。它的测试目标是基于URL的，因此，既可以用来测试Apache的负载压力，也可以测试nginx、lighthttp、tomcat、IIS等其它Web服务器的压力。

ab命令对发出负载的计算机要求很低，既不会占用很高CPU，也不会占用很多内存，但却会给目标服务器造成巨大的负载，其原理类似CC攻击。自己测试使用也须注意，否则一次上太多的负载，可能造成目标服务器因资源耗完，严重时甚至导致死机。

只要安装了Apache，就能够在Apache的安装目录中找到它。它的居住地址是`Apache安装目录/bin/ab.exe`。

在使用之前我们先来学习一下ab的用法。首先，我们输入cmd打开DOS窗口，然后将更改当前工作目录为：`Apache安装目录/bin/`。然后键入帮助命令`ab -help`(或者`ab /?`、`ab -h`)，就可以看到如下的用法介绍界面。

```sh
Usage: ab [options] [http[s]://]hostname[:port]/path
用法：ab [选项] 地址

选项：
Options are:
    -n requests    #执行的请求数，即一共发起多少请求。
    -c concurrency    #请求并发数。
    -t timelimit    #测试所进行的最大秒数。其内部隐含值是-n 50000，它可以使对服务器的测试限制在一个固定的总时间以内。默认时，没有时间限制。
    -s timeout    #指定每个请求的超时时间，默认是30秒。
    -b windowsize    #指定tcp窗口的大小，单位是字节。
    -B address    #指定在发起连接时绑定的ip地址是什么。
    -p postfile    #指定要POST的文件，同时要设置-T参数。
    -u putfile    #指定要PUT的文件，同时要设置-T参数。
    -T content-type    #指定使用POST或PUT上传文本时的文本类型，默认是'text/plain'。
    -v verbosity    #设置详细模式等级。
    -w    #将结果输出到html的表中。
    -i    #使用HEAD方式代替GET发起请求。
    -y attributes    #以表格方式输出时，设置html表格tr属性。
    -z attributes    #以表格方式输出时，设置html表格th或td属性。
    -C attribute    #添加cookie,比如'Apache=1234'。（可重复）
    -H attribute    #为请求追加一个额外的头部，比如'Accept-Encoding: gzip'。（可重复）
    -A attribute    #对服务器提供BASIC认证信任。用户名和密码由一个:隔开，并以base64编码形式发送。无论服务器是否需要(即,是否发送了401认证需求代码)，此字符串都会被发送。
    -P attribute    #对一个中转代理提供BASIC认证信任。用户名和密码由一个:隔开，并以base64编码形式发送。无论服务器是否需要(即, 是否发送了401认证需求代码)，此字符串都会被发送。
    -X proxy:port   #指定代理服务器的IP和端口。
    -V              #打印版本信息。
    -k              #启用HTTP KeepAlive功能，即在一个HTTP会话中执行多个请求。默认时，不启用KeepAlive功能。
    -d              #不显示"percentage served within XX [ms] table"的消息(为以前的版本提供支持)。
    -q              #如果处理的请求数大于150，ab每处理大约10%或者100个请求时，会在stderr输出一个进度计数。此-q标记可以抑制这些信息。
    -g filename     #把所有测试结果写入一个'gnuplot'或者TSV(以Tab分隔的)文件。此文件可以方便地导入到Gnuplot,IDL,Mathematica,Igor甚至Excel中。其中的第一行为标题。
    -e filename     #产生一个以逗号分隔的(CSV)文件，其中包含了处理每个相应百分比的请求所需要(从1%到100%)的相应百分比的(以微妙为单位)时间。由于这种格式已经“二进制化”，所以比'gnuplot'格式更有用。
    -r              #当收到错误时不要退出。
    -h              #输出帮助信息
    -Z ciphersuite  指定SSL/TLS密码套件
    -f protocol     指定SSL/TLS协议(SSL3, TLS1, TLS1.1, TLS1.2 or ALL)
```

### 安装ab的windows版

地址：http://httpd.apache.org/

![img](%E6%80%A7%E8%83%BD%E6%B5%8B%E8%AF%95.assets/907091-20190118154959069-1441173150.png)

\----------------------------------------

 

![img](%E6%80%A7%E8%83%BD%E6%B5%8B%E8%AF%95.assets/907091-20190118155028471-2111134996.png)

\--------------------------------------

![img](%E6%80%A7%E8%83%BD%E6%B5%8B%E8%AF%95.assets/907091-20190118155058578-23985407.png)

 

### ab的使用

虽然ab可以配置的参数选项比较多，但是，一般情况下我们只需要使用形如`ab -n 数字 -c 数字 url路径`的命令即可。比如，对网易云课堂 进行压力测试。测试总次数为1000，并发数为10(相当于10个用户同时访问，他们总共访问1000次)。

```
ab -n1000 -c10 http://study.163.com/
```

结果说明

```sh
This is ApacheBench, Version 2.3 <$Revision: 1826891 $>
Copyright 1996 Adam Twiss, Zeus Technology Ltd, http://www.zeustech.net/
Licensed to The Apache Software Foundation, http://www.apache.org/

Benchmarking study.163.com (be patient).....done

Server Software:        nginx #被测试服务器软件名称
Server Hostname:        study.163.com #服务器主机名
Server Port:            80 #服务器端口

Document Path:          / #请求的URL中的根绝对路径
Document Length:       314180 bytes #页面的大小

Concurrency Level:      10 #并发数
Time taken for tests:   5.020 seconds #整个测试耗时
Complete requests:      100 #总共完成的请求数量
Failed requests:        99 #失败数99（可能除了第一次剩下的99次全部错误。网易云课堂应该是对同一ip大量多次快速的访问做了限制）

   (Connect: 0, Receive: 0, Length: 99, Exceptions: 0)

Total transferred:      31473840 bytes #测试过程中产生的网络传输总量
HTML transferred:       31411340 bytes #测试过程中产生的HTML传输量
Requests per second:    19.92 [#/sec] (mean) #表示服务器吞吐量，每秒事务数，括号中的 mean 表示这是一个平均值
Time per request:       502.031 [ms] (mean) #表示用户请求的平均响应时间，后面括号中的mean表示这是一个平均值
Time per request:       50.203 [ms] (mean, across all concurrent requests) #表示服务器请求平均处理时间，即实际运行时间的平均值
Transfer rate:          6122.37 [Kbytes/sec] received #表示这些请求在单位时间内从服务器获取的数据长度，可以帮助排除是否存在网络流量过大导致响应时间延长的问题

Connection Times (ms)  #min最小值、mean平均值、[+/-sd]方差、median中位数、maxz最大值
                     min  mean[+/-sd] median   max
Connect:       20    24       2.6      25          32 #socket链路建立消耗，代表网络状况好

Processing:   260  436     80.5    430        614 #写入缓冲区消耗+链路消耗+服务器消耗

Waiting:        55    81       24.1    75          200 #写入缓冲区消耗+链路消耗+服务器消耗+读取数据消耗

Total:            288  461     80.0    455         636 #单个事务总时间

#网络上消耗的时间的分解，表示这些请求在单位时间内从服务器获取的数据长度

Percentage of the requests served within a certain time (ms)
  50%    455
  66%    500
  75%    534
  80%    548
  90%    565
  95%    581
  98%    609
  99%    636
 100%    636 (longest request)

#整个场景中所有请求的响应情况。在场景中每个请求都有一个响应时间，其中50％的用户响应时间小于455毫秒，60％的用户响应时间小于500毫秒，最大的响应时间小于636 毫秒
```

### ab案例-评估Node.js性能

> Windows PowerShell要在命令最开始输入&，因为命令带了“"”

```sh
# 启动测试环境mongodb，apache，mysql
"c:\Tools\mongodb\bin\mongod.exe" --config c:\Dev\mongodb\mongo.conf

# PHP Requests per second:    579.46 [#/sec] (mean)
"C:\Tools\xampp\apache\bin\ab.exe" -n 100000 -c 100 -p c:\Tools\xampp\htdocs\gxads\go\postdata.txt -T application/x-www-form-urlencoded "http://localhost.xywallet.com/api/getAds/f0d371d424c2e0fc4ee3a20bef39cd39"

# GO Requests per second:    2955.12 [#/sec] (mean)
# 先进入目录，否则找不到IP库（用的相对路径）
cd c:\Tools\xampp\htdocs\gxads\go\ 
c:\Tools\xampp\htdocs\gxads\go\api.exe
"C:\Tools\xampp\apache\bin\ab.exe" -n 100000 -c 100 -p c:\Tools\xampp\htdocs\gxads\go\postdata.txt -T application/x-www-form-urlencoded "http://localhost:1323/api/getAds/f0d371d424c2e0fc4ee3a20bef39cd39"

# Node.js 普通 Requests per second:     212.27 [#/sec] (mean) 
# 极易崩溃
cd c:\Dev\expressjs\ && node ./bin/www
"C:\Tools\xampp\apache\bin\ab.exe" -n 100000 -c 100 -p c:\Tools\xampp\htdocs\gxads\go\postdata.txt -T application/x-www-form-urlencoded "http://localhost:3000/users/f0d371d424c2e0fc4ee3a20bef39cd39"

# Node.js 连接池 Requests per second:    330.79 [#/sec] (mean) 
# 不会发生崩溃，但是并发能力并不强
"C:\Tools\xampp\apache\bin\ab.exe" -n 100000 -c 100 -p c:\Tools\xampp\htdocs\gxads\go\postdata.txt -T application/x-www-form-urlencoded "http://localhost:3000/users/pool/f0d371d424c2e0fc4ee3a20bef39cd39"

# Node.js pm2 cluster + 连接池 Requests per second:    1053.46 [#/sec] (mean) 
# 既不崩溃，性能也提升上来了
cd C:\Dev\expressjs
pm2 start ./bin/www -i max --watch
"C:\Tools\xampp\apache\bin\ab.exe" -n 100000 -c 100 -p c:\Tools\xampp\htdocs\gxads\go\postdata.txt -T application/x-www-form-urlencoded "http://localhost:3000/users/pool/f0d371d424c2e0fc4ee3a20bef39cd39"
```

### 总结

1. ab 判断成功与否知识判断2xx 响应码，不接收服务器的返回值，所以同样的响应ab测试支持的并发数大于LR和Jemter，TPS的   响应值也会比较大
2. ab运行的测试并发数与ab所运行的机器的cpu的颗粒度有很大的关系，cpu颗粒度越大，测试结果支持的并发数越大
3. ab适合测试HTTP协议的URL的连接并发，特别是Web系统的首页 

##  Apache JMeter

### JMeter简介

 Apache JMeter是Apache组织开发的基于Java的压力测试工具。用于对软件做压力测试，它最初被设计用于Web应用测 试但后来扩展到其他测试领域。 它可以用于测试静态和动态资源例如静态文件、Java 小服务程序、CGI 脚本、Java 对象、 数据库， FTP 服务器， 等等。JMeter 可以用于对服务器、网络或对象模拟巨大的负载，来在不同压力类别下测试它们的 强度和分析整体性能。另外，JMeter能够对应用程序做功能/回归测试，通过创建带有断言的脚本来验证你的程序返回了你期望的结果。

JMeter还支持各种丰富的插件，例如：

* JMeter gRPC插件：[skandgjxa/jmeter-grpc-request: JMeter gRPC Request load test plugin for gRPC (github.com)](https://github.com/skandgjxa/jmeter-grpc-request)

### Jmeter安装

#### JDK安装

由于Jmeter是基于java开发，首先需要下载安装JDK （目前JMeter只支持到Java 8，尚不支持 Java 9） 

1. 官网下载地址：http://www.oracle.com/technetwork/java/javase/downloads/index.html 

2. 选择Java SE 8u151/ 8u152，点击JDK下载 

   ![这里写图片描述](%E6%80%A7%E8%83%BD%E6%B5%8B%E8%AF%95.assets/445074-20171027110525633-2122104455.png)

3. 安装下载的JDK 

4. 配置系统环境变量

#### JMeter安装

1. 官网下载地址：http://jmeter.apache.org/download_jmeter.cgi
2. 下载最新JMeter 3.3版本：apache-jmeter-3.3.zip 
   ![这里写图片描述](%E6%80%A7%E8%83%BD%E6%B5%8B%E8%AF%95.assets/445074-20171027110534617-1488152581.png)
3. 下载完成后解压zip包
4. 启动JMeter 
   双击JMeter解压路径（apache-jmeter-3.3\bin）bin下面的jmeter.bat即可 
   ![这里写图片描述](%E6%80%A7%E8%83%BD%E6%B5%8B%E8%AF%95.assets/445074-20171027110542851-1179701029.png)

###  测试实例

我们选取最常见的百度搜索接口：

* 接口地址
  * [http://www.baidu.com/s?ie=utf-8&wd=jmeter性能测试](http://www.baidu.com/s?ie=utf-8&wd=jmeter性能测试)

* 请求参数
  * ie：编码方式，默认为utf-8 
  * wd: 搜索词

#### 返回结果

搜索结果，我们可以通过校验结果中是否含有搜索词wd来判断本次请求成功或失败。

#### JMeter脚本编写

##### 添加线程组

右键点击“测试计划” -> “添加” -> “Threads(Users)” -> “线程组” 

![这里写图片描述](%E6%80%A7%E8%83%BD%E6%B5%8B%E8%AF%95.assets/445074-20171027140206133-635713654.png) 

这里可以配置线程组名称，线程数，准备时长（Ramp-Up Period(in seconds)）循环次数，调度器等参数： 

![这里写图片描述](%E6%80%A7%E8%83%BD%E6%B5%8B%E8%AF%95.assets/445074-20171027140213008-328934523.png) 

线程组参数详解： 

1. 线程数：虚拟用户数。一个虚拟用户占用一个进程或线程。设置多少虚拟用户数在这里也就是设置多少个线程数。 
2. Ramp-Up Period(in seconds)准备时长：设置的虚拟用户数需要多长时间全部启动。如果线程数为10，准备时长为2，那么需要2秒钟启动10个线程，也就是每秒钟启动5个线程。 
3. 循环次数：每个线程发送请求的次数。如果线程数为10，循环次数为100，那么每个线程发送100次请求。总请求数为10*100=1000 。如果勾选了“永远”，那么所有线程会一直发送请求，一到选择停止运行脚本。 
4. Delay Thread creation until needed：直到需要时延迟线程的创建。 
5. 调度器：设置线程组启动的开始时间和结束时间(配置调度器时，需要勾选循环次数为永远) 
   1. 持续时间（秒）：测试持续时间，会覆盖结束时间 
   2. 启动延迟（秒)：测试延迟启动时间，会覆盖启动时间 
   3. 启动时间：测试启动时间，启动延迟会覆盖它。当启动时间已过，手动只需测试时当前时间也会覆盖它。 
   4. 结束时间：测试结束时间，持续时间会覆盖它。

因为接口调试需要，我们暂时均使用默认设置，待后面真正执行性能测试时再回来配置。

##### 添加HTTP请求

右键点击“线程组” -> “添加” -> “Sampler” -> “HTTP请求” 

![这里写图片描述](%E6%80%A7%E8%83%BD%E6%B5%8B%E8%AF%95.assets/445074-20171027140259273-1510991394.png) 

对于我们的接口[http://www.baidu.com/s?ie=utf-8&wd=jmeter性能测试](http://www.baidu.com/s?ie=utf-8&wd=jmeter性能测试)，可以参考下图填写： 

![这里写图片描述](%E6%80%A7%E8%83%BD%E6%B5%8B%E8%AF%95.assets/445074-20171027140307492-347021148.png) 

Http请求主要参数详解：

1. Web服务器 
   * 协议：向目标服务器发送HTTP请求协议，可以是HTTP或HTTPS，默认为HTTP 
   * 服务器名称或IP ：HTTP请求发送的目标服务器名称或IP 
   * 端口号：目标服务器的端口号，默认值为80 
2. Http请求 
   * 方法：发送HTTP请求的方法，可用方法包括GET、POST、HEAD、PUT、OPTIONS、TRACE、DELETE等。 
   * 路径：目标URL路径（URL中去掉服务器地址、端口及参数后剩余部分） 
   * Content encoding ：编码方式，默认为ISO-8859-1编码，这里配置为utf-8
3. 同请求一起发送参数 
   * 在请求中发送的URL参数，用户可以将URL中所有参数设置在本表中，表中每行为一个参数（对应URL中的 name=value）
   * 注意参数传入中文时需要勾选“编码”

##### 添加察看结果树

右键点击“线程组” -> “添加” -> “监听器” -> “察看结果树” 

![这里写图片描述](%E6%80%A7%E8%83%BD%E6%B5%8B%E8%AF%95.assets/445074-20171027140319258-966761370.png) 

这时，我们运行Http请求，修改响应数据格式为“HTML Source Formatted”，可以看到本次搜索返回结果页面标题为“jmeter性能测试_百度搜索”。 

![这里写图片描述](%E6%80%A7%E8%83%BD%E6%B5%8B%E8%AF%95.assets/445074-20171027140532539-746436850.png)

##### 添加用户自定义变量

我们可以添加用户自定义变量用以Http请求参数化，右键点击“线程组” -> “添加” -> “配置元件” -> “用户定义的变量”： 

![这里写图片描述](%E6%80%A7%E8%83%BD%E6%B5%8B%E8%AF%95.assets/445074-20171027140605430-1268843149.png) 

新增一个参数wd，存放搜索词： 

![这里写图片描述](%E6%80%A7%E8%83%BD%E6%B5%8B%E8%AF%95.assets/445074-20171027140612445-284376525.png) 
并在Http请求中使用该参数，格式为：${wd} 
![这里写图片描述](%E6%80%A7%E8%83%BD%E6%B5%8B%E8%AF%95.assets/445074-20171027142440383-411258040.png)

##### 添加断言

右键点击“HTTP请求” -> “添加”-> “断言” -> “响应断言” 

![这里写图片描述](%E6%80%A7%E8%83%BD%E6%B5%8B%E8%AF%95.assets/445074-20171027140641898-37297868.png) 

我们校验返回的文本中是否包含搜索词，添加参数${wd}到要测试的模式中： 

![这里写图片描述](%E6%80%A7%E8%83%BD%E6%B5%8B%E8%AF%95.assets/445074-20171027140652367-2031213364.png)

##### 添加断言结果

右键点击“HTTP请求” -> “添加”-> “监听器” -> “断言结果” 

![这里写图片描述](%E6%80%A7%E8%83%BD%E6%B5%8B%E8%AF%95.assets/445074-20171027140746320-1682152745.png)



这时，我们再运行一次就可以看到断言结果成功或失败了 

![这里写图片描述](%E6%80%A7%E8%83%BD%E6%B5%8B%E8%AF%95.assets/445074-20171027140801117-1841738517.png)

##### 添加聚合报告

右键点击“线程组” -> “添加” -> “监听器” -> “聚合报告”，用以存放性能测试报告 

![这里写图片描述](%E6%80%A7%E8%83%BD%E6%B5%8B%E8%AF%95.assets/445074-20171027140821930-1938293505.png) 

这样，我们就完成了一个完整Http接口的JMeter性能测试脚本编写。

####  执行性能测试

#####  配置线程组

点击线程组，配置本次性能测试相关参数：线程数，循环次数，持续时间等，这里我们配置并发用户数为10，持续时间为60s 

![这里写图片描述](%E6%80%A7%E8%83%BD%E6%B5%8B%E8%AF%95.assets/445074-20171027140835211-2041991555.png)

##### 执行测试

点击绿色小箭头按钮即可启动测试，测试之前需要点击小扫把按钮清除之前的调试结果。 

![这里写图片描述](%E6%80%A7%E8%83%BD%E6%B5%8B%E8%AF%95.assets/445074-20171027140859086-183557970.png)

####  分析测试报告

待性能测试执行完成后，打开聚合报告可以看到： 

![这里写图片描述](%E6%80%A7%E8%83%BD%E6%B5%8B%E8%AF%95.assets/445074-20171027140910148-1035669123.png)



聚合报告参数详解： 

1. Label：每个 JMeter 的 element（例如 HTTP Request）都有一个 Name 属性，这里显示的就是 Name 属性的值 
2. #Samples：请求数——表示这次测试中一共发出了多少个请求，如果模拟10个用户，每个用户迭代10次，那么这里显示100 
3. Average：平均响应时间——默认情况下是单个 Request 的平均响应时间，当使用了 Transaction Controller 时，以Transaction 为单位显示平均响应时间 
4. Median：中位数，也就是 50％ 用户的响应时间 
5. 90% Line：90％ 用户的响应时间 
6. Min：最小响应时间 
7. Max：最大响应时间 
8. Error%：错误率——错误请求数/请求总数 
9. Throughput：吞吐量——默认情况下表示每秒完成的请求数（Request per Second），当使用了 Transaction Controller 时，也可以表示类似 LoadRunner 的 Transaction per Second 数 
10. KB/Sec：每秒从服务器端接收到的数据量，相当于LoadRunner中的Throughput/Sec

一般而言，性能测试中我们需要重点关注的数据有： #Samples 请求数，Average 平均响应时间，Min 最小响应时间，Max 最大响应时间，Error% 错误率及Throughput 吞吐量。

> D:\Dev\lessons\DevOps\examples\baidu_demo.jmx
>
> :bug: 因为百度现在做了防机器人处理，所以测试肯定都会失败

#### 使用JMeter进行getAds测试

> D:\Dev\lessons\DevOps\examples\getAds.jmx

![image-20211203144148506](%E6%80%A7%E8%83%BD%E6%B5%8B%E8%AF%95.assets/image-20211203144148506.png)

## 总结

看到这些工具，我在做一个性能测试任务的时候该怎么选择呢？

### 根据压测场景来选择

根据压测场景是什么来选择。如果说是一次性单接口的场景就可以使用 AB。如果说是复杂事物多接口需要业务场景的话，就会选择 JMeter 这类工具可以构造丰富的场景能满足需求。

### 我需要提供多大压力

我要提供多大的压力？是1000 QPS还是万级以上的。压力很大的话就要考虑压力测试工具是否支持分布式，能否快速扩展 agent。对于 JMeter 来讲就很好的支持了。

### 周期性需求

业务可能频繁上线，服务随时变动。可能会有一个周期性需求，按月巡检。需要一个场景文件，我可以去做数据驱动，实时跟进数据改变。最后希望结果落库。

### 二次开发的需求

JMeter 开源插件化思想，支持 Thrift，Dubbo 等多种协议。可以快速平台化。社区问题支持：JMeter 开放社区，广泛使用。有问题的时候能够快速获得答案。

### 业务场景的模拟

如果要对业务场景进行仿真，比如打开一个页面（期间加载了N个静态文件和微服务）这些性能测试软件估计都不够用，可以选用puppeteer或者selenium进行浏览器仿真。

由于puppeteer能够直接调用chrome的性能API进行编程，所以是首选
